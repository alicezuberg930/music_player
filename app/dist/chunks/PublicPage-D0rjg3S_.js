import{j as e,U as a,V as s,W as r}from"./radix-ui-chunk-CKI-Y2yK.js";import{D as t,c as n,u as l,L as i,T as c,a as d,s as o,b as u,d as x,e as h,f as m,g as f,h as j,i as p,j as g,B as w,k as v,l as b,m as y,n as N,o as C,p as k,q as T,r as L,t as z,v as E,w as S,x as R,y as M,z as _,A as q,C as A,E as P,F as U,G as D,S as I,H as F,I as O,J as $,K as B,M as V,N as H,O as K,P as X,Q as G,R as J,U as Q,V as W,W as Y,X as Z}from"../entries/index-CDdcWDMj.js";import{d as ee,a as ae,u as se,L as re,k as te,O as ne}from"./react-chunk-lWhfHSeX.js";import{q as le,H as ie,E as ce,s as de,t as oe,v as ue,m as xe,w as he,R as me,x as fe,y as je,V as pe,z as ge,B as we,M as ve,e as be,X as ye,U as Ne,F as Ce,G as ke,J as Te,K as Le,Q as ze,Y as Ee}from"./mix-chunk-CKIEerH-.js";import"./i18next-chunk-BHxx249G.js";import"./redux-chunk-DUkfmT9l.js";const Se="audio-files";let Re=null;const Me=async()=>(Re??=le("music-player-audio",1,{upgrade(e){e.objectStoreNames.contains(Se)||e.createObjectStore(Se)}}),Re);function _e({...a}){return e.jsx(t.Root,{"data-slot":"drawer",...a})}function qe({...a}){return e.jsx(t.Trigger,{"data-slot":"drawer-trigger",...a})}function Ae({...a}){return e.jsx(t.Portal,{"data-slot":"drawer-portal",...a})}function Pe({className:a,...s}){return e.jsx(t.Overlay,{"data-slot":"drawer-overlay",className:n("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",a),...s})}function Ue({className:a,children:s,...r}){return e.jsxs(Ae,{"data-slot":"drawer-portal",children:[e.jsx(Pe,{}),e.jsxs(t.Content,{"data-slot":"drawer-content",className:n("group/drawer-content bg-background fixed z-50 flex h-auto flex-col ","data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b","data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t","data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm","data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",a),...r,children:[e.jsx("div",{className:"bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block"}),s]})]})}function De({className:a,...s}){return e.jsx("div",{"data-slot":"drawer-header",className:n("flex flex-col gap-0.5 p-4 group-data-[vaul-drawer-direction=bottom]/drawer-content:text-center group-data-[vaul-drawer-direction=top]/drawer-content:text-center md:gap-1.5 md:text-left",a),...s})}function Ie({className:a,...s}){return e.jsx(t.Title,{"data-slot":"drawer-title",className:n("text-foreground font-semibold",a),...s})}function Fe({className:a,...s}){return e.jsx(t.Description,{"data-slot":"drawer-description",className:n("text-muted-foreground text-sm",a),...s})}const Oe=({drawerTrigger:a,audioRef:s})=>{const{currentSong:r}=l(e=>e.music),[t,n]=ee.useState(""),[d,o]=ee.useState(0),u=ee.useRef(null),x=ee.useRef(null);return ee.useEffect(()=>{if((async()=>{if(r?.lyricsFile){const e=await fetch(r.lyricsFile),a=await e.text();n(a.replaceAll("\r\n","\n"))}})(),s.current){const e=setInterval(()=>{s.current&&o(1e3*s.current.currentTime)},1500);return()=>clearInterval(e)}},[s.current]),ee.useEffect(()=>{if(u.current&&x.current){const e=u.current.clientHeight,a=u.current.offsetTop-10*e;x.current.scrollTo({top:a,behavior:"smooth"})}},[d]),e.jsxs(_e,{children:[e.jsx(qe,{asChild:!0,children:a}),e.jsx(Ue,{className:"bg-white/70 min-h-[calc(100vh-96px)] backdrop-blur-md",children:e.jsxs("div",{className:"mx-auto w-full h-screen max-w-6xl relative",children:[e.jsxs(De,{children:[e.jsx(Ie,{children:"Lời bài hát"}),e.jsxs(Fe,{children:[r?.title," - ",r?.artistNames]})]}),e.jsx("div",{ref:x,className:"h-[65vh] overflow-auto px-4",children:t.length>0?e.jsx(i,{lrc:t,currentMillisecond:d,lineRenderer:({index:a,active:s,line:r})=>e.jsx(c,{ref:s?u:null,variant:"h4",className:"my-8 text-center transition-colors duration-300 "+(s?"text-main-500":"text-gray-400"),children:r.content},a)}):e.jsx(c,{className:"text-center text-gray-400",children:"Không có lời bài hát"})})]})})]})},$e=()=>{const a=d(),{showSideBarRight:s}=l(e=>e.app),{currentSong:r,isPlaying:t,currentPlaylistSongs:n}=l(e=>e.music),[i,b]=ae.useState(!1),[y,N]=ae.useState(0),[C,k]=ae.useState(50),[T,L]=ae.useState(!0),z=ae.useRef(!1),E=ae.useRef(0),S=ae.useRef(null),R=ae.useRef(null),M=ae.useRef(null),_=ae.useRef(null),q=ae.useRef(!1),A=ae.useMemo(()=>{if(!r)return;const e=n.findIndex(e=>e.id===r.id);return-1===e?void 0:n[e+1]},[r,n]),P=e=>{if(!R.current||!M.current||!S.current)return;const a=R.current.getBoundingClientRect(),s=(e-a.left)/a.width*100,t=Math.max(0,Math.min(100,Math.round(s)));S.current.style.cssText=`right: ${100-t}%`,r?.duration&&(M.current.currentTime=r.duration*t/100)},U=()=>{q.current=!1},D=ae.useCallback(()=>{if(n.length>0)for(let e=0;e<n.length;e++)if(n[e].id===r?.id){n[e+1]&&(a(o(n[e+1])),M.current?.play());break}},[n,r,a]),I=ae.useCallback(()=>{if(n.length>0)for(let e=0;e<n.length;e++)if(n[e].id===r?.id){n[e-1]&&(a(o(n[e-1])),M.current?.play());break}},[n,r,a]),F=ae.useCallback(async()=>{M.current&&(t&&!M.current.paused?(a(u(!1)),M.current.pause()):!t&&M.current.paused&&(a(u(!0)),await M.current.play()))},[t,a]),O=()=>{L(!1),M.current?.play().then(e=>a(u(!0))).catch(e=>{})},$=async()=>{if(a(u(!1)),_.current&&(_.current.innerText="00:00"),S.current&&(S.current.style.cssText="right: 100%"),r?.stream){L(!0),await(async e=>{try{const a=await Me();return!!(await a.get(Se,e))}catch(a){return!1}})(r.id)||await(async(e,a)=>{try{const s=await fetch(a);if(!s.ok)throw new Error(`Failed to fetch audio: ${s.statusText}`);const r=await s.blob(),t=await Me();return await t.put(Se,{songId:e,blob:r,url:a,cachedAt:Date.now()},e),!0}catch(s){return!1}})(r.id,r.stream);let e=await(async e=>{try{const a=await Me(),s=await a.get(Se,e);return s?URL.createObjectURL(s.blob):null}catch(a){return null}})(r.id);e&&(M.current=new Audio(e),M.current.load(),M.current.volume=C/100,M.current.oncanplaythrough=O,(()=>{let e;const s=M.current;if(!s?.src)return;const t=()=>{_.current.innerText=g(Math.floor(s.currentTime));let a=Math.round(s.currentTime/r.duration*1e4)/100;S.current&&(S.current.style.cssText=`right: ${100-a}%`),e=requestAnimationFrame(t)},n=()=>e=requestAnimationFrame(t),l=()=>cancelAnimationFrame(e),i=()=>{l(),z.current?M.current&&M.current.play():E.current>0?1===E.current?M.current&&(M.current.currentTime=0,M.current.play()):D():(a(u(!1)),s.pause())};s.addEventListener("play",n),s.addEventListener("pause",l),s.addEventListener("ended",i)})())}};return ae.useEffect(()=>($(),()=>{M.current&&(M.current.oncanplaythrough=null,M.current.pause(),M.current=null)}),[r]),ae.useEffect(()=>{const e=e=>{if("Space"===e.code&&e.target instanceof HTMLElement){const a=e.target.tagName.toLowerCase();if("input"===a||"textarea"===a||e.target.isContentEditable)return;e.preventDefault(),F()}},a=e=>{if(("ArrowLeft"===e.code||"ArrowRight"===e.code)&&e.target instanceof HTMLElement){const a=e.target.tagName.toLowerCase();if("input"===a||"textarea"===a||e.target.isContentEditable)return;e.preventDefault(),"ArrowLeft"===e.code&&I(),"ArrowRight"===e.code&&D()}};return globalThis.addEventListener("keydown",e),globalThis.addEventListener("keydown",a),()=>{globalThis.removeEventListener("keydown",e),globalThis.removeEventListener("keydown",a)}},[t,F,I,D]),ae.useEffect(()=>{M.current&&(M.current.volume=C/100)},[C]),ae.useEffect(()=>{a(x()),z.current=i},[i]),ae.useEffect(()=>{E.current=y},[y]),ae.useEffect(()=>{M.current&&M.current.paused&&t&&M.current.play(),!M.current||M.current.paused||t||M.current.pause()},[t]),e.jsx("div",{className:"fixed w-full z-20 h-24 content-center bg-main-400 select-none border-t border-main-500/20 shadow-up",children:e.jsxs("div",{className:"flex justify-between px-4",children:[e.jsxs("div",{className:"flex-1 items-center gap-4 hidden md:flex",children:[e.jsx(h.LazyLoadImage,{src:r?.thumbnail,effect:"blur",alt:"thumbnail",className:"w-16 h-16 object-cover"}),e.jsxs("div",{children:[e.jsx(c,{className:"font-semibold text-gray-600 line-clamp-2 text-ellipsis max-w-40",children:r?.title}),e.jsx(c,{className:"text-gray-500 line-clamp-2 text-ellipsis max-w-40 m-0 lg:text-xs",children:r?.artistNames})]}),e.jsx(ie,{size:20}),e.jsx(ce,{size:20})]}),e.jsxs("div",{className:"flex flex-1 items-center gap-4 flex-col",children:[e.jsxs("div",{className:"flex gap-8 items-center",children:[e.jsxs(m,{children:[e.jsx(f,{asChild:!0,className:`cursor-pointer ${i&&"text-purple-600"}`,onClick:()=>b(e=>!e),children:e.jsx(de,{size:20})}),e.jsx(j,{children:"Bật phát ngẫu nhiên"})]}),e.jsx("span",{className:n.length?"cursor-pointer":"text-gray-500",children:e.jsx(oe,{size:20,onClick:I})}),e.jsx("span",{onClick:F,className:"hover:text-main-500",children:T?e.jsx(p,{strokeColor:"#0E8080",width:42,height:42}):t?e.jsx(ue,{size:42}):e.jsx(xe,{size:42})}),e.jsxs(m,{children:[e.jsx(f,{asChild:!0,children:e.jsx("span",{className:n.length?"cursor-pointer":"text-gray-500",children:e.jsx(he,{size:20,onClick:D})})}),A&&e.jsxs(j,{children:[e.jsx(c,{className:"font-semibold",children:"Phát tiếp theo"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(h.LazyLoadImage,{src:A.thumbnail,effect:"blur",alt:"thumbnail",className:"w-10 h-10 object-cover rounded-md"}),e.jsxs("div",{children:[e.jsx(c,{className:"m-0 text-gray-400",children:A.title}),e.jsx(c,{className:"m-0 text-gray-400",children:A.artistNames})]})]})]})]}),e.jsxs(m,{children:[e.jsx(f,{asChild:!0,className:`cursor-pointer ${y&&"text-purple-600"}`,onClick:()=>N(2===y?0:y+1),children:1===y?e.jsx(me,{size:20}):e.jsx(fe,{size:20})}),e.jsx(j,{children:"Phát lại tất cả bài hát"})]})]}),e.jsxs("div",{className:"w-full flex items-center justify-center gap-3 text-sm",children:[e.jsx(c,{ref:_,className:"font-semibold text-gray-500 m-0",children:"00:00"}),e.jsx("div",{className:"relative h-1 hover:h-2 bg-[#0000001a] w-3/5 rounded-full cursor-pointer",onClick:e=>{P(e.clientX)},onMouseDown:e=>{q.current=!0,P(e.clientX)},onMouseMove:e=>{q.current&&P(e.clientX)},onMouseUp:U,onMouseLeave:U,ref:R,children:e.jsx("div",{ref:S,className:"absolute top-0 left-0 bottom-0 h-full bg-main-500 rounded-full"})}),e.jsx(c,{className:"font-semibold text-gray-500 m-0",children:g(r?.duration??0)})]})]}),e.jsxs("div",{className:"flex-1 items-center gap-4 hidden md:flex justify-end",children:[e.jsx(Oe,{drawerTrigger:e.jsx(je,{size:20}),audioRef:M}),e.jsx(w,{size:"icon-lg",variant:"ghost",onClick:()=>k(0===C?50:0),children:C>=50?e.jsx(pe,{}):0===C?e.jsx(ge,{}):e.jsx(we,{})}),e.jsx("input",{type:"range",step:1,min:0,max:100,onChange:e=>k(Number(e.target.value)),value:C,className:"h-1 hover:h-2"}),e.jsx(w,{className:"text-white",size:"lg",onClick:()=>a(v(!s)),children:e.jsx(ve,{})})]})]})})},Be=()=>{const{translate:a}=b(),s=se(),[r,t]=ae.useState("");return e.jsx("div",{className:"max-w-[440px] w-full",children:e.jsx("div",{className:"bg-[#ffffff54] text-gray-500 rounded-3xl py-2",children:e.jsxs("div",{className:"flex w-full",children:[e.jsx("div",{className:"pl-4 self-center",children:e.jsx(be,{})}),e.jsx("input",{type:"text",className:"outline-none px-4 w-full bg-transparent",placeholder:a("search_placeholder"),onKeyUp:e=>(e=>{"Enter"===e.code&&e.currentTarget.value.length>2&&s({pathname:"search/all",search:"?q="+e.currentTarget.value})})(e),onChange:e=>{t(e.target.value)},value:r}),e.jsx("div",{className:(r?"block":"hidden")+" self-center pr-4",onClick:()=>t(""),children:e.jsx(ye,{})})]})})})};function Ve({className:s,...r}){return e.jsx(a,{"data-slot":"avatar",className:n("relative flex size-8 shrink-0 overflow-hidden rounded-full",s),...r})}function He({className:a,...r}){return e.jsx(s,{"data-slot":"avatar-image",className:n("aspect-square size-full",a),...r})}function Ke({className:a,...s}){return e.jsx(r,{"data-slot":"avatar-fallback",className:n("bg-muted flex size-full items-center justify-center rounded-full",a),...s})}const Xe=()=>{const{user:a,signout:s}=y(),{translate:r}=b();return e.jsxs(N,{children:[e.jsx(C,{asChild:!0,children:e.jsx(Ve,{children:a?.avatar?e.jsx(He,{src:a?.avatar,alt:a?.id}):e.jsx(Ke,{children:a?.fullname.charAt(0)})})}),e.jsxs(k,{className:"w-56 z-100",align:"end",children:[e.jsx(T,{children:r("my_account")}),e.jsxs(L,{children:[e.jsxs(z,{children:[e.jsx(re,{to:E.UPLOAD_MUSIC,children:r("profile")}),e.jsx(S,{children:e.jsx(Ne,{})})]}),e.jsxs(z,{children:[e.jsx(re,{to:E.UPLOAD_MUSIC,children:r("settings")}),e.jsx(S,{children:e.jsx(Ce,{})})]}),e.jsxs(z,{children:[e.jsx(re,{to:E.UPLOAD_MUSIC,children:r("upload_music")}),e.jsx(S,{children:e.jsx(ke,{})})]}),e.jsxs(z,{children:[e.jsx(re,{to:E.ADD_ARTIST,children:r("add_artist")}),e.jsx(S,{children:e.jsx(Te,{})})]})]}),e.jsx(R,{}),e.jsxs(z,{onClick:s,children:[r("logout"),e.jsx(S,{children:e.jsx(Le,{})})]})]})]})},Ge=()=>{const{onChangeLang:a,currentLang:s,allLangs:r}=b();return e.jsxs(N,{children:[e.jsx(C,{asChild:!0,children:e.jsx(Ve,{className:"rounded-sm",children:e.jsx(He,{src:s.icon,alt:s.value})})}),e.jsx(k,{className:"w-56 z-100",align:"end",children:e.jsx(L,{children:r.map(s=>e.jsxs(z,{onClick:()=>a(s.value),children:[e.jsx(c,{children:s.label}),e.jsx(S,{children:e.jsx("img",{src:s.icon,alt:s.value})})]},s.value))})})]})},Je=()=>{const{translate:a}=b();return e.jsxs(M,{children:[e.jsx(_,{asChild:!0,children:e.jsx(c,{variant:"span",className:"text-white",children:a("sign_in")})}),e.jsx(q,{className:"sm:max-w-md",children:e.jsxs(A,{defaultValue:"sign_in",children:[e.jsxs(P,{children:[e.jsx(U,{value:"sign_in",children:a("sign_in")}),e.jsx(U,{value:"sign_up",children:a("sign_up")})]}),e.jsx(D,{value:"sign_in",children:e.jsx(Ye,{})}),e.jsx(D,{value:"sign_up",children:e.jsx(Ze,{})})]})})]})},Qe=()=>{const a=se(),{isAuthenticated:s}=y();return e.jsxs("div",{className:"w-full flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex my-2 gap-2 flex-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 text-white cursor-pointer",children:[e.jsx(ze,{onClick:()=>a(-1)}),e.jsx(Ee,{onClick:()=>a(1)})]}),e.jsx(Be,{})]}),e.jsx(Ge,{}),s?e.jsx(Xe,{}):e.jsx(Je,{})]})},We=()=>{const{showSideBarRight:a,scrollTop:s}=l(e=>e.app),{currentSong:r}=l(e=>e.music),t=te(),n=d();return e.jsxs("div",{className:"w-full bg-main-300 "+(r?"h-[calc(100vh-96px)]":"h-screen"),children:[e.jsxs("div",{className:"w-full h-full flex",children:[e.jsx(I,{}),e.jsxs("div",{className:"flex-1 flex flex-col relative",children:[e.jsx("header",{className:`fixed top-0 right-0 left-0 z-49 transition-all duration-500 ease-in-out sm:left-20 lg:left-48 flex-none backdrop-blur-md px-4 md:px-8 ${a&&"xl:right-[330px]"} ${s?"bg-transparent":"bg-[#969696cc]"}`,children:e.jsx(Qe,{})}),e.jsx("main",{className:`px-4 md:px-8 mt-20 mb-6 flex-auto overflow-y-scroll scroll-smooth transition-all duration-600 ease-in-out ${a&&"xl:mr-[330px] mr-0"}`,onScroll:e=>{(t.pathname.includes("/artist")||t.pathname.includes("/zing-chart"))&&0===e.currentTarget.scrollTop?n(O(!0)):n(O(!1))},children:e.jsx(ne,{})})]}),e.jsx(F,{})]}),r&&e.jsx($e,{})]})},Ye=()=>{const{signin:a}=y(),{translate:s}=b(),r=$().shape({email:B().required("Email is required"),password:B().required("Password is required")}),t=ae.useMemo(()=>({email:"tien23851@gmail.com",password:"123456"}),[]),n=V({resolver:H(r),defaultValues:t}),{handleSubmit:l}=n;return e.jsxs(K,{methods:n,onSubmit:l(async e=>{await a(e.email,e.password)}),children:[e.jsx(X,{children:e.jsx(G,{children:s("sign_in_description")})}),e.jsxs(J,{className:"gap-4 my-6",children:[e.jsx(Q,{name:"email",type:"text",fieldLabel:"Email",placeholder:"Type your email"}),e.jsx(Q,{name:"password",type:"password",fieldLabel:"Password",placeholder:"Type your password"})]}),e.jsx(W,{children:e.jsx(Y,{orientation:"vertical",children:e.jsxs(Y,{orientation:"horizontal",children:[e.jsx(Z,{asChild:!0,children:e.jsx(w,{type:"reset",variant:"outline",className:"flex-auto",children:"Reset"})}),e.jsx(w,{type:"submit",className:"flex-auto",children:"Submit"})]})})})]})},Ze=()=>{const{signup:a}=y(),{translate:s}=b(),r=$().shape({fullname:B().required("Full name is required"),email:B().required("Email is required"),password:B().required("Password is required"),confirmPassword:B().required("Confirm password is required")}),t=ae.useMemo(()=>({fullname:"",email:"",password:"",confirmPassword:""}),[]),n=V({resolver:H(r),defaultValues:t}),{handleSubmit:l}=n;return e.jsxs(K,{methods:n,onSubmit:l(async e=>{await a(e.fullname,e.email,e.password)}),children:[e.jsx(X,{children:e.jsx(G,{children:s("sign_up_description")})}),e.jsxs(J,{className:"gap-4 my-6",children:[e.jsx(Q,{name:"fullname",type:"text",fieldLabel:"Fullname",placeholder:"Type your full name"}),e.jsx(Q,{name:"email",type:"text",fieldLabel:"Email",placeholder:"Type your email"}),e.jsx(Q,{name:"password",type:"password",fieldLabel:"Password",placeholder:"Type your password"}),e.jsx(Q,{name:"confirmPassword",type:"password",fieldLabel:"Confirm password",placeholder:"Confirm your password"})]}),e.jsx(W,{children:e.jsx(Y,{orientation:"vertical",children:e.jsxs(Y,{orientation:"horizontal",children:[e.jsx(Z,{asChild:!0,children:e.jsx(w,{type:"reset",variant:"outline",className:"flex-auto",children:"Reset"})}),e.jsx(w,{type:"submit",className:"flex-auto",children:"Submit"})]})})})]})};export{We as default};
