import{j as e,U as a,V as s,W as t}from"./radix-ui-chunk-CKI-Y2yK.js";import{D as r,c as n,u as l,L as i,T as c,a as d,s as o,b as u,d as x,e as h,f as m,g as j,h as f,i as p,j as g,B as w,k as v,l as b,m as y,n as N,o as C,p as k,q as T,r as L,t as z,v as E,w as S,x as R,y as M,z as _,A as q,C as A,E as P,F as U,G as D,H as I,S as F,I as O,J as $,K as B,M as V,N as H,O as K,P as X,Q as G,R as J,U as Q,V as W,W as Y,X as Z,Y as ee}from"../entries/index-CVAUm5od.js";import{d as ae,a as se,u as te,L as re,k as ne,O as le}from"./react-chunk-lWhfHSeX.js";import{q as ie,H as ce,E as de,s as oe,t as ue,v as xe,m as he,w as me,R as je,x as fe,y as pe,V as ge,z as we,B as ve,M as be,e as ye,X as Ne,U as Ce,F as ke,G as Te,J as Le,K as ze,Q as Ee,Y as Se}from"./mix-chunk-CKIEerH-.js";import"./i18next-chunk-BHxx249G.js";import"./redux-chunk-DUkfmT9l.js";const Re="audio-files";let Me=null;const _e=async()=>(Me??=ie("music-player-audio",1,{upgrade(e){e.objectStoreNames.contains(Re)||e.createObjectStore(Re)}}),Me);function qe({...a}){return e.jsx(r.Root,{"data-slot":"drawer",...a})}function Ae({...a}){return e.jsx(r.Trigger,{"data-slot":"drawer-trigger",...a})}function Pe({...a}){return e.jsx(r.Portal,{"data-slot":"drawer-portal",...a})}function Ue({className:a,...s}){return e.jsx(r.Overlay,{"data-slot":"drawer-overlay",className:n("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",a),...s})}function De({className:a,children:s,...t}){return e.jsxs(Pe,{"data-slot":"drawer-portal",children:[e.jsx(Ue,{}),e.jsxs(r.Content,{"data-slot":"drawer-content",className:n("group/drawer-content bg-background fixed z-50 flex h-auto flex-col ","data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b","data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t","data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm","data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",a),...t,children:[e.jsx("div",{className:"bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block"}),s]})]})}function Ie({className:a,...s}){return e.jsx("div",{"data-slot":"drawer-header",className:n("flex flex-col gap-0.5 p-4 group-data-[vaul-drawer-direction=bottom]/drawer-content:text-center group-data-[vaul-drawer-direction=top]/drawer-content:text-center md:gap-1.5 md:text-left",a),...s})}function Fe({className:a,...s}){return e.jsx(r.Title,{"data-slot":"drawer-title",className:n("text-foreground font-semibold",a),...s})}function Oe({className:a,...s}){return e.jsx(r.Description,{"data-slot":"drawer-description",className:n("text-muted-foreground text-sm",a),...s})}const $e=({drawerTrigger:a,audioRef:s})=>{const{currentSong:t}=l(e=>e.music),[r,n]=ae.useState(""),[d,o]=ae.useState(0),u=ae.useRef(null),x=ae.useRef(null);return ae.useEffect(()=>{if((async()=>{if(t?.lyricsFile){const e=await fetch(t.lyricsFile),a=await e.text();n(a.replaceAll("\r\n","\n"))}})(),s.current){const e=setInterval(()=>{s.current&&o(1e3*s.current.currentTime)},1500);return()=>clearInterval(e)}},[s.current]),ae.useEffect(()=>{if(u.current&&x.current){const e=u.current.clientHeight,a=u.current.offsetTop-10*e;x.current.scrollTo({top:a,behavior:"smooth"})}},[d]),e.jsxs(qe,{children:[e.jsx(Ae,{asChild:!0,children:a}),e.jsx(De,{className:"bg-white/70 min-h-[calc(100vh-96px)] backdrop-blur-md",children:e.jsxs("div",{className:"mx-auto w-full h-screen max-w-6xl relative",children:[e.jsxs(Ie,{children:[e.jsx(Fe,{children:"Lời bài hát"}),e.jsxs(Oe,{children:[t?.title," - ",t?.artistNames]})]}),e.jsx("div",{ref:x,className:"h-[65vh] overflow-auto px-4",children:r.length>0?e.jsx(i,{lrc:r,currentMillisecond:d,lineRenderer:({index:a,active:s,line:t})=>e.jsx(c,{ref:s?u:null,variant:"h4",className:"my-8 text-center transition-colors duration-300 "+(s?"text-main-500":"text-gray-400"),children:t.content},a)}):e.jsx(c,{className:"text-center text-gray-400",children:"Không có lời bài hát"})})]})})]})},Be=()=>{const a=d(),{showSideBarRight:s}=l(e=>e.app),{currentSong:t,isPlaying:r,currentPlaylistSongs:n}=l(e=>e.music),[i,b]=se.useState(!1),[y,N]=se.useState(0),[C,k]=se.useState(50),[T,L]=se.useState(!0),z=se.useRef(!1),E=se.useRef(0),S=se.useRef(null),R=se.useRef(null),M=se.useRef(null),_=se.useRef(null),q=se.useRef(!1),A=se.useMemo(()=>{if(!t)return;const e=n.findIndex(e=>e.id===t.id);return-1===e?void 0:n[e+1]},[t,n]),P=e=>{if(!R.current||!M.current||!S.current)return;const a=R.current.getBoundingClientRect(),s=(e-a.left)/a.width*100,r=Math.max(0,Math.min(100,Math.round(s)));S.current.style.cssText=`right: ${100-r}%`,t?.duration&&(M.current.currentTime=t.duration*r/100)},U=()=>{q.current=!1},D=se.useCallback(()=>{if(n.length>0)for(let e=0;e<n.length;e++)if(n[e].id===t?.id){n[e+1]&&(a(o(n[e+1])),M.current?.play());break}},[n,t,a]),I=se.useCallback(()=>{if(n.length>0)for(let e=0;e<n.length;e++)if(n[e].id===t?.id){n[e-1]&&(a(o(n[e-1])),M.current?.play());break}},[n,t,a]),F=se.useCallback(async()=>{M.current&&(r&&!M.current.paused?(a(u(!1)),M.current.pause()):!r&&M.current.paused&&(a(u(!0)),await M.current.play()))},[r,a]),O=()=>{L(!1),M.current?.play().then(e=>a(u(!0))).catch(e=>{})},$=async()=>{if(a(u(!1)),_.current&&(_.current.innerText="00:00"),S.current&&(S.current.style.cssText="right: 100%"),t?.stream){L(!0),await(async e=>{try{const a=await _e();return!!(await a.get(Re,e))}catch(a){return!1}})(t.id)||await(async(e,a)=>{try{const s=await fetch(a);if(!s.ok)throw new Error(`Failed to fetch audio: ${s.statusText}`);const t=await s.blob(),r=await _e();return await r.put(Re,{songId:e,blob:t,url:a,cachedAt:Date.now()},e),!0}catch(s){return!1}})(t.id,t.stream);let e=await(async e=>{try{const a=await _e(),s=await a.get(Re,e);return s?URL.createObjectURL(s.blob):null}catch(a){return null}})(t.id);e&&(M.current=new Audio(e),M.current.load(),M.current.volume=C/100,M.current.oncanplaythrough=O,(()=>{let e;const s=M.current;if(!s?.src)return;const r=()=>{_.current.innerText=g(Math.floor(s.currentTime));let a=Math.round(s.currentTime/t.duration*1e4)/100;S.current&&(S.current.style.cssText=`right: ${100-a}%`),e=requestAnimationFrame(r)},n=()=>e=requestAnimationFrame(r),l=()=>cancelAnimationFrame(e),i=()=>{l(),z.current?M.current&&M.current.play():E.current>0?1===E.current?M.current&&(M.current.currentTime=0,M.current.play()):D():(a(u(!1)),s.pause())};s.addEventListener("play",n),s.addEventListener("pause",l),s.addEventListener("ended",i)})())}};return se.useEffect(()=>($(),()=>{M.current&&(M.current.oncanplaythrough=null,M.current.pause(),M.current=null)}),[t]),se.useEffect(()=>{const e=e=>{if("Space"===e.code&&e.target instanceof HTMLElement){const a=e.target.tagName.toLowerCase();if("input"===a||"textarea"===a||e.target.isContentEditable)return;e.preventDefault(),F()}},a=e=>{if(("ArrowLeft"===e.code||"ArrowRight"===e.code)&&e.target instanceof HTMLElement){const a=e.target.tagName.toLowerCase();if("input"===a||"textarea"===a||e.target.isContentEditable)return;e.preventDefault(),"ArrowLeft"===e.code&&I(),"ArrowRight"===e.code&&D()}};return globalThis.addEventListener("keydown",e),globalThis.addEventListener("keydown",a),()=>{globalThis.removeEventListener("keydown",e),globalThis.removeEventListener("keydown",a)}},[r,F,I,D]),se.useEffect(()=>{M.current&&(M.current.volume=C/100)},[C]),se.useEffect(()=>{a(x()),z.current=i},[i]),se.useEffect(()=>{E.current=y},[y]),se.useEffect(()=>{M.current&&M.current.paused&&r&&M.current.play(),!M.current||M.current.paused||r||M.current.pause()},[r]),e.jsx("div",{className:"fixed w-full z-20 h-24 content-center bg-main-400 select-none border-t border-main-500/20 shadow-up",children:e.jsxs("div",{className:"flex justify-between px-4",children:[e.jsxs("div",{className:"flex-1 items-center gap-4 hidden md:flex",children:[e.jsx(h.LazyLoadImage,{src:t?.thumbnail,effect:"blur",alt:"thumbnail",className:"w-16 h-16 object-cover"}),e.jsxs("div",{children:[e.jsx(c,{className:"font-semibold text-gray-600 line-clamp-2 text-ellipsis max-w-40",children:t?.title}),e.jsx(c,{className:"text-gray-500 line-clamp-2 text-ellipsis max-w-40 m-0 lg:text-xs",children:t?.artistNames})]}),e.jsx(ce,{size:20}),e.jsx(de,{size:20})]}),e.jsxs("div",{className:"flex flex-1 items-center gap-4 flex-col",children:[e.jsxs("div",{className:"flex gap-8 items-center",children:[e.jsxs(m,{children:[e.jsx(j,{asChild:!0,className:`cursor-pointer ${i&&"text-purple-600"}`,onClick:()=>b(e=>!e),children:e.jsx(oe,{size:20})}),e.jsx(f,{children:"Bật phát ngẫu nhiên"})]}),e.jsx("span",{className:n.length?"cursor-pointer":"text-gray-500",children:e.jsx(ue,{size:20,onClick:I})}),e.jsx("button",{onClick:F,className:"hover:text-main-500",children:T?e.jsx(p,{strokeColor:"#0E8080",width:42,height:42}):r?e.jsx(xe,{size:42}):e.jsx(he,{size:42})}),e.jsxs(m,{children:[e.jsx(j,{asChild:!0,children:e.jsx(me,{size:20,onClick:D,className:n.length?"cursor-pointer":"text-gray-500"})}),A&&e.jsxs(f,{children:[e.jsx(c,{className:"font-semibold",children:"Phát tiếp theo"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(h.LazyLoadImage,{src:A.thumbnail,effect:"blur",alt:"thumbnail",className:"w-10 h-10 object-cover rounded-md"}),e.jsxs("div",{className:"text-gray-400",children:[e.jsx(c,{className:"m-0",children:A.title}),e.jsx(c,{className:"m-0 lg:text-xs",children:A.artistNames})]})]})]})]}),e.jsxs(m,{children:[e.jsx(j,{asChild:!0,className:`cursor-pointer ${y&&"text-purple-600"}`,onClick:()=>N(2===y?0:y+1),children:1===y?e.jsx(je,{size:20}):e.jsx(fe,{size:20})}),e.jsx(f,{children:"Phát lại tất cả bài hát"})]})]}),e.jsxs("div",{className:"w-full flex items-center justify-center gap-3 text-sm",children:[e.jsx(c,{ref:_,className:"font-semibold text-gray-500 m-0",children:"00:00"}),e.jsx("button",{className:"relative h-1 hover:h-2 bg-[#0000001a] w-3/5 rounded-full cursor-pointer",onClick:e=>{P(e.clientX)},onMouseDown:e=>{q.current=!0,P(e.clientX)},onMouseMove:e=>{q.current&&P(e.clientX)},onMouseUp:U,onMouseLeave:U,ref:R,children:e.jsx("div",{ref:S,className:"absolute top-0 left-0 bottom-0 h-full bg-main-500 rounded-full"})}),e.jsx(c,{className:"font-semibold text-gray-500 m-0",children:g(t?.duration??0)})]})]}),e.jsxs("div",{className:"flex-1 items-center gap-4 hidden md:flex justify-end",children:[e.jsx($e,{drawerTrigger:e.jsx(pe,{size:20}),audioRef:M}),e.jsx(w,{size:"icon-lg",variant:"ghost",onClick:()=>k(0===C?50:0),children:C>=50?e.jsx(ge,{}):0===C?e.jsx(we,{}):e.jsx(ve,{})}),e.jsx("input",{type:"range",step:1,min:0,max:100,onChange:e=>k(Number(e.target.value)),value:C,className:"h-1 hover:h-2"}),e.jsx(w,{className:"text-white",size:"lg",onClick:()=>a(v(!s)),children:e.jsx(be,{})})]})]})})},Ve=()=>{const{translate:a}=b(),s=te(),[t,r]=se.useState("");return e.jsx("div",{className:"max-w-[440px] w-full",children:e.jsx("div",{className:"bg-[#ffffff54] text-gray-500 rounded-3xl py-2",children:e.jsxs("div",{className:"flex w-full",children:[e.jsx("div",{className:"pl-4 self-center",children:e.jsx(ye,{})}),e.jsx("input",{type:"text",className:"outline-none px-4 w-full bg-transparent",placeholder:a("search_placeholder"),onKeyUp:e=>(e=>{"Enter"===e.code&&e.currentTarget.value.length>2&&s({pathname:"search/all",search:"?q="+e.currentTarget.value})})(e),onChange:e=>{r(e.target.value)},value:t}),e.jsx("div",{className:(t?"block":"hidden")+" self-center pr-4",onClick:()=>r(""),children:e.jsx(Ne,{})})]})})})};function He({className:s,...t}){return e.jsx(a,{"data-slot":"avatar",className:n("relative flex size-8 shrink-0 overflow-hidden rounded-full",s),...t})}function Ke({className:a,...t}){return e.jsx(s,{"data-slot":"avatar-image",className:n("aspect-square size-full",a),...t})}function Xe({className:a,...s}){return e.jsx(t,{"data-slot":"avatar-fallback",className:n("bg-muted flex size-full items-center justify-center rounded-full",a),...s})}const Ge=()=>{const{user:a,signout:s}=y(),{translate:t}=b();return e.jsxs(N,{children:[e.jsx(C,{asChild:!0,children:e.jsx(He,{children:a?.avatar?e.jsx(Ke,{src:a?.avatar,alt:a?.id}):e.jsx(Xe,{children:a?.fullname.charAt(0)})})}),e.jsxs(k,{className:"w-56 z-100",align:"end",children:[e.jsx(T,{children:t("my_account")}),e.jsxs(L,{children:[e.jsxs(z,{children:[e.jsx(re,{to:E.UPLOAD_MUSIC,children:t("profile")}),e.jsx(S,{children:e.jsx(Ce,{})})]}),e.jsxs(z,{children:[e.jsx(re,{to:E.UPLOAD_MUSIC,children:t("settings")}),e.jsx(S,{children:e.jsx(ke,{})})]}),e.jsxs(z,{children:[e.jsx(re,{to:E.UPLOAD_MUSIC,children:t("upload_music")}),e.jsx(S,{children:e.jsx(Te,{})})]}),e.jsxs(z,{children:[e.jsx(re,{to:E.ADD_ARTIST,children:t("add_artist")}),e.jsx(S,{children:e.jsx(Le,{})})]})]}),e.jsx(R,{}),e.jsxs(z,{onClick:s,children:[t("logout"),e.jsx(S,{children:e.jsx(ze,{})})]})]})]})},Je=()=>{const{onChangeLang:a,currentLang:s,allLangs:t}=b();return e.jsxs(N,{children:[e.jsx(C,{asChild:!0,children:e.jsx(He,{className:"rounded-sm",children:e.jsx(Ke,{src:s.icon,alt:s.value})})}),e.jsx(k,{className:"w-56 z-100",align:"end",children:e.jsx(L,{children:t.map(s=>e.jsxs(z,{onClick:()=>a(s.value),children:[e.jsx(c,{children:s.label}),e.jsx(S,{children:e.jsx("img",{src:s.icon,alt:s.value})})]},s.value))})})]})},Qe=()=>{const{translate:a}=b();return e.jsxs(M,{children:[e.jsx(_,{asChild:!0,children:e.jsx(c,{variant:"span",className:"text-white",children:a("sign_in")})}),e.jsxs(q,{className:"sm:max-w-md",children:[e.jsx(A,{}),e.jsxs(P,{defaultValue:"sign_in",children:[e.jsxs(U,{children:[e.jsx(D,{value:"sign_in",children:a("sign_in")}),e.jsx(D,{value:"sign_up",children:a("sign_up")})]}),e.jsx(I,{value:"sign_in",children:e.jsx(Ze,{})}),e.jsx(I,{value:"sign_up",children:e.jsx(ea,{})})]})]})]})},We=()=>{const a=te(),{isAuthenticated:s}=y();return e.jsxs("div",{className:"w-full flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex my-2 gap-2 flex-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 text-white cursor-pointer",children:[e.jsx(Ee,{onClick:()=>a(-1)}),e.jsx(Se,{onClick:()=>a(1)})]}),e.jsx(Ve,{})]}),e.jsx(Je,{}),s?e.jsx(Ge,{}):e.jsx(Qe,{})]})},Ye=()=>{const{showSideBarRight:a,scrollTop:s}=l(e=>e.app),{currentSong:t}=l(e=>e.music),r=ne(),n=d();return e.jsxs("div",{className:"w-full bg-main-300 "+(t?"h-[calc(100vh-96px)]":"h-screen"),children:[e.jsxs("div",{className:"w-full h-full flex",children:[e.jsx(F,{}),e.jsxs("div",{className:"flex-1 flex flex-col relative",children:[e.jsx("header",{className:`fixed top-0 right-0 left-0 z-49 transition-all duration-500 ease-in-out sm:left-20 lg:left-48 flex-none backdrop-blur-md px-4 md:px-8 ${a&&"xl:right-[330px]"} ${s?"bg-transparent":"bg-[#969696cc]"}`,children:e.jsx(We,{})}),e.jsx("main",{className:`px-4 md:px-8 mt-14 pb-12 flex-auto overflow-y-scroll scroll-smooth transition-all duration-600 ease-in-out ${a&&"xl:mr-[330px] mr-0"}`,onScroll:e=>{(r.pathname.includes("/artist")||r.pathname.includes("/zing-chart"))&&0===e.currentTarget.scrollTop?n($(!0)):n($(!1))},children:e.jsx(le,{})})]}),e.jsx(O,{})]}),t&&e.jsx(Be,{})]})},Ze=()=>{const{signin:a}=y(),{translate:s}=b(),t=B().shape({email:V().required("Email is required"),password:V().required("Password is required")}),r=se.useMemo(()=>({email:"tien23851@gmail.com",password:"123456"}),[]),n=H({resolver:K(t),defaultValues:r}),{handleSubmit:l}=n;return e.jsxs(X,{methods:n,onSubmit:l(async e=>{await a(e.email,e.password)}),children:[e.jsxs(G,{children:[e.jsx(A,{}),e.jsx(J,{children:s("sign_in_description")})]}),e.jsxs(Q,{className:"gap-4 my-6",children:[e.jsx(W,{name:"email",type:"text",fieldLabel:"Email",placeholder:"Type your email"}),e.jsx(W,{name:"password",type:"password",fieldLabel:"Password",placeholder:"Type your password"})]}),e.jsx(Y,{children:e.jsx(Z,{orientation:"vertical",children:e.jsxs(Z,{orientation:"horizontal",children:[e.jsx(ee,{asChild:!0,children:e.jsx(w,{type:"reset",variant:"outline",className:"flex-auto",children:"Reset"})}),e.jsx(w,{type:"submit",className:"flex-auto",children:"Submit"})]})})})]})},ea=()=>{const{signup:a}=y(),{translate:s}=b(),t=B().shape({fullname:V().required("Full name is required"),email:V().required("Email is required"),password:V().required("Password is required"),confirmPassword:V().required("Confirm password is required")}),r=se.useMemo(()=>({fullname:"",email:"",password:"",confirmPassword:""}),[]),n=H({resolver:K(t),defaultValues:r}),{handleSubmit:l}=n;return e.jsxs(X,{methods:n,onSubmit:l(async e=>{await a(e.fullname,e.email,e.password)}),children:[e.jsxs(G,{children:[e.jsx(A,{}),e.jsx(J,{children:s("sign_up_description")})]}),e.jsxs(Q,{className:"gap-4 my-6",children:[e.jsx(W,{name:"fullname",type:"text",fieldLabel:"Fullname",placeholder:"Type your full name"}),e.jsx(W,{name:"email",type:"text",fieldLabel:"Email",placeholder:"Type your email"}),e.jsx(W,{name:"password",type:"password",fieldLabel:"Password",placeholder:"Type your password"}),e.jsx(W,{name:"confirmPassword",type:"password",fieldLabel:"Confirm password",placeholder:"Confirm your password"})]}),e.jsx(Y,{children:e.jsx(Z,{orientation:"vertical",children:e.jsxs(Z,{orientation:"horizontal",children:[e.jsx(ee,{asChild:!0,children:e.jsx(w,{type:"reset",variant:"outline",className:"flex-auto",children:"Reset"})}),e.jsx(w,{type:"submit",className:"flex-auto",children:"Submit"})]})})})]})};export{Ye as default};
